<h1><%= @globe.name %></h1>
<p>Switch Globe:
<%=  select_tag "globe[id]", raw("<option value='#{@globe.id}'>#{@globe.name}</option>") + options_from_collection_for_select(@shadowglobes.find(:all, :order => 'name'), "id", "name"), :onChange => "javascript:navigate_to_shadow_globe(document.getElementById('globe_id').value)" %>
</p>
<p>
  <% current_type = ""
     @data_elements.sort{|x,y| x.type <=> y.type}.each { |data_element| %>
    <% derived_obj = eval(data_element.type).find_by_id(data_element.id)
       attributes = data_element.type.constantize.column_names - DataElement.column_names %>
    <% if derived_obj.nil? then %>
      <%= puts data_element.inspect %>
    <% end %>
    <% if current_type != data_element.type && current_type != "" %>
    </table>
    <% end %>
    <% if current_type == "" || current_type != data_element.type then
          current_type = data_element.type %>
    <table width="100%">
      <thead>
        <th colspan="<%= attributes.count + 4 %>">
          <%= data_element.type %>
        </th>
      </thead>
    <% end %>
      <tr>
        <td><%= data_element.name.to_s %></td>
        <%  attributes.each {|attribute| %>
        <td><%= derived_obj[attribute] %></td>
        <% } %>
        <td><%= link_to "Edit", edit_globe_data_element_path(@globe, data_element) %></td>
        <td><%= link_to "XML", globe_data_element_path(@globe, data_element, format: "xml") %></td>
        <td><%= link_to "CSV", globe_data_element_path(@globe, data_element, format: "csv") %></td>
      </tr>
  <% } %>
    </table>
</p>
<p>
  <%= link_to("[New Data Element]", new_globe_data_element_url(@globe)) %>
</p>  
<%= render "/the_bottom_line" %>
