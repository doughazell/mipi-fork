<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: DataSheetsController
  
    &mdash; Documentation by YARD 0.8.2.1
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (D)</a> &raquo;
    
    
    <span class="title">DataSheetsController</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: DataSheetsController
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ActionController::Base</li>
          
            <li class="next"><span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></li>
          
            <li class="next">DataSheetsController</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2"><span class='object_link'><a href="DataSheetsHelper.html" title="DataSheetsHelper (module)">DataSheetsHelper</a></span></dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">app/controllers/data_sheets_controller.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
This controller handles the rendering of the main page containing the one
or more data elements retrieved through the data model. The two major
methods that are triggered by end-user activity are: &#8216;preview&#8217;
and &#8216;change&#8217;.
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Author:</p>
<ul class="author">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
Paul Long
</p>
</div>
      
    </li>
  
</ul>

</div>






  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#_draw-instance_method" title="#_draw (instance method)">- (Object) <strong>_draw</strong>(data_sheet) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#calculate_data_sheet_elements-instance_method" title="#calculate_data_sheet_elements (instance method)">- (Object) <strong>calculate_data_sheet_elements</strong>(data_sheet) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
This method identifies the data model objects that will be required to
support the data sheet that has been passed as a parameter.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#change-instance_method" title="#change (instance method)">- (Object) <strong>change</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create-instance_method" title="#create (instance method)">- (Object) <strong>create</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
POST /data_sheets POST /data_sheets.xml.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#destroy-instance_method" title="#destroy (instance method)">- (Object) <strong>destroy</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
DELETE /data_sheets/1 DELETE /data_sheets/1.xml.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#draw-instance_method" title="#draw (instance method)">- (Object) <strong>draw</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Within this method we must pull the database information back the
collection of database objects that are associated with this data sheet.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#edit-instance_method" title="#edit (instance method)">- (Object) <strong>edit</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
GET /data_sheets/1/edit.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#editable-instance_method" title="#editable (instance method)">- (Object) <strong>editable</strong>(data_element, database_column, id) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#index-instance_method" title="#index (instance method)">- (Object) <strong>index</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
GET /data_sheets GET /data_sheets.xml.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#new-instance_method" title="#new (instance method)">- (Object) <strong>new</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
GET /data_sheets/new GET /data_sheets/new.xml.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#preview-instance_method" title="#preview (instance method)">- (Object) <strong>preview</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
&#8216;Preview&#8217; is our bland look at how the data can be represented.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#show-instance_method" title="#show (instance method)">- (Object) <strong>show</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
GET /data_sheets/1 GET /data_sheets/1.xml.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update-instance_method" title="#update (instance method)">- (Object) <strong>update</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
PUT /data_sheets/1 PUT /data_sheets/1.xml.
</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="DataSheetsHelper.html" title="DataSheetsHelper (module)">DataSheetsHelper</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="DataSheetsHelper.html#Create_Default_Files-instance_method" title="DataSheetsHelper#Create_Default_Files (method)">#Create_Default_Files</a></span>, <span class='object_link'><a href="DataSheetsHelper.html#Data_Element_Properties_Popup-instance_method" title="DataSheetsHelper#Data_Element_Properties_Popup (method)">#Data_Element_Properties_Popup</a></span>, <span class='object_link'><a href="DataSheetsHelper.html#Expand_Data_Element-instance_method" title="DataSheetsHelper#Expand_Data_Element (method)">#Expand_Data_Element</a></span>, <span class='object_link'><a href="DataSheetsHelper.html#ForeignKey_PickList-instance_method" title="DataSheetsHelper#ForeignKey_PickList (method)">#ForeignKey_PickList</a></span>, <span class='object_link'><a href="DataSheetsHelper.html#Label2TextBox2-instance_method" title="DataSheetsHelper#Label2TextBox2 (method)">#Label2TextBox2</a></span>, <span class='object_link'><a href="DataSheetsHelper.html#Label_TextBox_Switch-instance_method" title="DataSheetsHelper#Label_TextBox_Switch (method)">#Label_TextBox_Switch</a></span>, <span class='object_link'><a href="DataSheetsHelper.html#LinkDataSheet-instance_method" title="DataSheetsHelper#LinkDataSheet (method)">#LinkDataSheet</a></span>, <span class='object_link'><a href="DataSheetsHelper.html#Subscription_Data_Element-instance_method" title="DataSheetsHelper#Subscription_Data_Element (method)">#Subscription_Data_Element</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="ApplicationController.html#set_current_user-instance_method" title="ApplicationController#set_current_user (method)">#set_current_user</a></span></p>

  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="UrlHelper.html" title="UrlHelper (module)">UrlHelper</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="UrlHelper.html#url_for-instance_method" title="UrlHelper#url_for (method)">#url_for</a></span>, <span class='object_link'><a href="UrlHelper.html#with_subdomain-instance_method" title="UrlHelper#with_subdomain (method)">#with_subdomain</a></span></p>

  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="_draw-instance_method">
  
    - (<tt>Object</tt>) <strong>_draw</strong>(data_sheet) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


161
162
163
164
165
166
167
168
169
170
171
172
173
174
175</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/data_sheets_controller.rb', line 161</span>

<span class='kw'>def</span> <span class='id identifier rubyid__draw'>_draw</span><span class='lparen'>(</span><span class='id identifier rubyid_data_sheet'>data_sheet</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_template'>template</span> <span class='op'>=</span> <span class='const'>Liquid</span><span class='op'>::</span><span class='const'>Template</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>{{source_value}} {{destination_value}}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@text</span> <span class='op'>=</span> <span class='id identifier rubyid_template'>template</span><span class='period'>.</span><span class='id identifier rubyid_render'>render</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>source_value</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>pop</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>destination_value</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>corn</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>test test test test test test test test test test test test test test test test</span><span class='tstring_end'>&quot;</span></span>
  
  <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
    <span class='comment'># Render the data into the pre-defined .html.erb file stored within:
</span>    <span class='comment'>#         'views/data_sheets/pages/'
</span><span class='comment'>#      format.html { render @data_sheet.file_location }
</span>    <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_render'>render</span> <span class='symbol'>:partial</span> <span class='op'>=&gt;</span> <span class='ivar'>@data_sheet</span><span class='period'>.</span><span class='id identifier rubyid_file_location'>file_location</span> <span class='rbrace'>}</span>
     <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_xml'>xml</span>  <span class='lbrace'>{</span> <span class='id identifier rubyid_render'>render</span> <span class='symbol'>:xml</span> <span class='op'>=&gt;</span> <span class='ivar'>@data_sheet</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
 
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="calculate_data_sheet_elements-instance_method">
  
    - (<tt>Object</tt>) <strong>calculate_data_sheet_elements</strong>(data_sheet) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
This method identifies the data model objects that will be required to
support the data sheet that has been passed as a parameter. A special
&#8216;variable&#8217; will be defined dynamically that will allow the
&#8216;Page&#8217; to render the data within the partial associated with
this data sheet.
</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>data_sheet</span>
      
      
        <span class='type'></span>
      
      
      
        &mdash;
        <div class='inline'><p>
The data sheet of which we need to collate the appropriate data model
elements.
</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/data_sheets_controller.rb', line 182</span>

<span class='kw'>def</span> <span class='id identifier rubyid_calculate_data_sheet_elements'>calculate_data_sheet_elements</span><span class='lparen'>(</span><span class='id identifier rubyid_data_sheet'>data_sheet</span><span class='rparen'>)</span>
  <span class='ivar'>@list_of_collections</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@globe_id</span> <span class='op'>=</span> <span class='id identifier rubyid_data_sheet'>data_sheet</span><span class='period'>.</span><span class='id identifier rubyid_profile'>profile</span><span class='period'>.</span><span class='id identifier rubyid_globe_id'>globe_id</span>
  <span class='ivar'>@custom_stylesheet</span> <span class='op'>=</span> <span class='id identifier rubyid_data_sheet'>data_sheet</span><span class='period'>.</span><span class='id identifier rubyid_style_sheets'>style_sheets</span>

  <span class='comment'># This has been included because we found the data model was not being loaded all the
</span>  <span class='comment'># time. The exact cause of this has not been identified.
</span><span class='comment'>#    puts DataElement.all.count                        # TODO: Research Bug
</span>  
  <span class='comment'># Retrieve the data rows from the link table 'presentations' that will tell
</span>  <span class='comment'># us what data collections should be pulled back for this sheet.
</span>  <span class='ivar'>@outputs</span> <span class='op'>=</span> <span class='const'>Presentation</span><span class='period'>.</span><span class='id identifier rubyid_find_all_by_data_sheet_id'>find_all_by_data_sheet_id</span><span class='lparen'>(</span><span class='id identifier rubyid_data_sheet'>data_sheet</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
  
  <span class='kw'>if</span> <span class='ivar'>@outputs</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span> <span class='op'>==</span> <span class='int'>0</span> <span class='kw'>then</span>
    <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
<span class='comment'>#        format.html { render :partial =&gt; 'data_sheets/pages/missing_presentation', :notice =&gt; &quot;Error: Missing Presentation Data&quot; }
</span>      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_preview_globe_url'>preview_globe_url</span><span class='lparen'>(</span><span class='ivar'>@globe</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:notice</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error: Missing Presentation Data</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
  
    <span class='id identifier rubyid_hash_of_variables'>hash_of_variables</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    
    <span class='ivar'>@outputs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_sheet_part'>sheet_part</span><span class='op'>|</span>
      <span class='ivar'>@part</span> <span class='op'>=</span> <span class='const'>DataElementCollection</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_sheet_part'>sheet_part</span><span class='period'>.</span><span class='id identifier rubyid_data_element_collection_id'>data_element_collection_id</span><span class='rparen'>)</span>
<span class='comment'>#        puts @part.inspect
</span><span class='comment'>#        puts &quot;-----&quot;
</span>      <span class='kw'>if</span> <span class='id identifier rubyid_hash_of_variables'>hash_of_variables</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span> <span class='ivar'>@part</span><span class='period'>.</span><span class='id identifier rubyid_variable_name'>variable_name</span> <span class='kw'>then</span>
        <span class='id identifier rubyid_hash_of_variables'>hash_of_variables</span><span class='lbracket'>[</span><span class='ivar'>@part</span><span class='period'>.</span><span class='id identifier rubyid_variable_name'>variable_name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_hash_of_variables'>hash_of_variables</span><span class='lbracket'>[</span><span class='ivar'>@part</span><span class='period'>.</span><span class='id identifier rubyid_variable_name'>variable_name</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='int'>1</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_hash_of_variables'>hash_of_variables</span><span class='lbracket'>[</span><span class='ivar'>@part</span><span class='period'>.</span><span class='id identifier rubyid_variable_name'>variable_name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>1</span>
        <span class='id identifier rubyid_hash_of_variables'>hash_of_variables</span><span class='lbracket'>[</span><span class='ivar'>@part</span><span class='period'>.</span><span class='id identifier rubyid_variable_name'>variable_name</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_offset</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>0</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    
<span class='comment'>#      puts hash_of_variables.to_s
</span>    <span class='id identifier rubyid_hash_of_variables'>hash_of_variables</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span><span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
<span class='comment'>#        puts &quot;#{key} is #{value}&quot;
</span>      <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>&gt;</span> <span class='int'>1</span> <span class='kw'>then</span>
<span class='comment'>#          puts &quot;Creating array for #{key}&quot;
</span>        <span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='rbrace'>}</span><span class='tstring_content'>_array</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='rbrace'>}</span>
    
    <span class='comment'># For each of these data rows there shall be a data collection row to retrieve
</span>    <span class='comment'># and resolve.
</span>    <span class='ivar'>@outputs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_sheet_part'>sheet_part</span><span class='op'>|</span>

      <span class='comment'># Grab the data element collection.
</span>      <span class='ivar'>@part</span> <span class='op'>=</span> <span class='const'>DataElementCollection</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_sheet_part'>sheet_part</span><span class='period'>.</span><span class='id identifier rubyid_data_element_collection_id'>data_element_collection_id</span><span class='rparen'>)</span>
      
      <span class='kw'>if</span> <span class='ivar'>@part</span><span class='period'>.</span><span class='id identifier rubyid_historic?'>historic?</span> <span class='kw'>then</span>
        <span class='comment'># For historical data sets, such as bank transactions; twitter feeds; etc. we need to
</span>        <span class='comment'># carry out a 'find all' and carry out pagination.
</span><span class='comment'>#          instance_variable_set(&quot;#{@part.variable_name}&quot;, eval(@part.data_element_type).find_all_by_data_element_collection_id_and_globe_id(@part.id, @globe_id, :order =&gt; @part.order_by_column).paginate(:page =&gt; params[:page], :per_page =&gt; @part.page_limit))
</span>        <span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@part</span><span class='period'>.</span><span class='id identifier rubyid_variable_name'>variable_name</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_eval'>eval</span><span class='lparen'>(</span><span class='ivar'>@part</span><span class='period'>.</span><span class='id identifier rubyid_data_element_type'>data_element_type</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_find_all_by_data_element_collection_id_and_globe_id'>find_all_by_data_element_collection_id_and_globe_id</span><span class='lparen'>(</span><span class='ivar'>@part</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='ivar'>@globe_id</span><span class='comma'>,</span> <span class='symbol'>:order</span> <span class='op'>=&gt;</span> <span class='ivar'>@part</span><span class='period'>.</span><span class='id identifier rubyid_order_by_column'>order_by_column</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='comment'># For non-historic data sets, e.g. personal data; statuses; overdraft limits; etc. we
</span>        <span class='comment'># only need to retrieve one record.
</span>        <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_hash_of_variables'>hash_of_variables</span><span class='lbracket'>[</span><span class='ivar'>@part</span><span class='period'>.</span><span class='id identifier rubyid_variable_name'>variable_name</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='int'>1</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_puts'>puts</span> <span class='ivar'>@part</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
          <span class='id identifier rubyid_puts'>puts</span> <span class='ivar'>@globe_id</span>
<span class='comment'>#            instance_variable_set(&quot;#{@part.variable_name}&quot;, eval(@part.data_element_type).find(:first, :conditions =&gt; { :data_element_collection_id =&gt; @part.id, :globe_id =&gt; @globe_id }, :order =&gt; &quot;version DESC&quot;))
</span><span class='comment'>#            instance_variable_set(&quot;#{@part.variable_name}&quot;, @part.data_element_type.constantize.find(:first, :conditions =&gt; { :data_element_collection_id =&gt; @part.id, :globe_id =&gt; @globe_id }, :order =&gt; &quot;version DESC&quot;))
</span>          <span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@part</span><span class='period'>.</span><span class='id identifier rubyid_variable_name'>variable_name</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@part</span><span class='period'>.</span><span class='id identifier rubyid_data_element_type'>data_element_type</span><span class='period'>.</span><span class='id identifier rubyid_constantize'>constantize</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='symbol'>:first</span><span class='comma'>,</span> <span class='symbol'>:conditions</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='symbol'>:data_element_collection_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@part</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:globe_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@globe_id</span><span class='comma'>,</span> <span class='symbol'>:current</span> <span class='op'>=&gt;</span> <span class='kw'>true</span> <span class='rbrace'>}</span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_offset'>offset</span> <span class='op'>=</span> <span class='id identifier rubyid_hash_of_variables'>hash_of_variables</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@part</span><span class='period'>.</span><span class='id identifier rubyid_variable_name'>variable_name</span><span class='rbrace'>}</span><span class='tstring_content'>_offset</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
<span class='comment'>#            instance_variable_set(&quot;@tmp&quot;, eval(@part.data_element_type).find_by_data_element_collection_id_and_globe_id(@part.id, @globe_id, :order =&gt; &quot;created_at DESC&quot;))
</span><span class='comment'>#            instance_variable_set(&quot;@tmp&quot;, @part.data_element_type.constantize.find_by_data_element_collection_id_and_globe_id(@part.id, @globe_id, :order =&gt; &quot;created_at DESC&quot;))
</span>          <span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>@tmp</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@part</span><span class='period'>.</span><span class='id identifier rubyid_data_element_type'>data_element_type</span><span class='period'>.</span><span class='id identifier rubyid_constantize'>constantize</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='symbol'>:first</span><span class='comma'>,</span> <span class='symbol'>:conditions</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='symbol'>:data_element_collection_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@part</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:globe_id</span> <span class='op'>=&gt;</span> <span class='ivar'>@globe_id</span><span class='comma'>,</span> <span class='symbol'>:current</span> <span class='op'>=&gt;</span> <span class='kw'>true</span> <span class='rbrace'>}</span><span class='rparen'>)</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_hash_of_variables'>hash_of_variables</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@part</span><span class='period'>.</span><span class='id identifier rubyid_variable_name'>variable_name</span><span class='rbrace'>}</span><span class='tstring_content'>_offset</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_hash_of_variables'>hash_of_variables</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@part</span><span class='period'>.</span><span class='id identifier rubyid_variable_name'>variable_name</span><span class='rbrace'>}</span><span class='tstring_content'>_offset</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='int'>1</span>
          <span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@part</span><span class='period'>.</span><span class='id identifier rubyid_variable_name'>variable_name</span><span class='rbrace'>}</span><span class='tstring_content'>_array</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_eval'>eval</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@part</span><span class='period'>.</span><span class='id identifier rubyid_variable_name'>variable_name</span><span class='rbrace'>}</span><span class='tstring_content'>_array + [@tmp]</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='comment'>#            instance_variable_set(&quot;#{@part.variable_name}_array&quot;, eval(&quot;#{@part.variable_name}_array + [@tmp]&quot;).paginate(:page =&gt; params[:page], :per_page =&gt; @part.data_element_type.constantize::DEFAULT_PAGE_LIMIT))
</span>        <span class='kw'>end</span>
      <span class='kw'>end</span>
      
      <span class='comment'># Build up list of 'variable' names. Here we're removing the leading '@' sign.
</span>      <span class='ivar'>@list_of_collections</span> <span class='op'>&lt;&lt;</span> <span class='ivar'>@part</span><span class='period'>.</span><span class='id identifier rubyid_variable_name'>variable_name</span><span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span> <span class='ivar'>@part</span><span class='period'>.</span><span class='id identifier rubyid_variable_name'>variable_name</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>-</span> <span class='int'>1</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
    
    <span class='comment'># Debug
</span>    <span class='id identifier rubyid_puts'>puts</span> <span class='ivar'>@list_of_collections</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>    
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="change-instance_method">
  
    - (<tt>Object</tt>) <strong>change</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/data_sheets_controller.rb', line 266</span>

<span class='kw'>def</span> <span class='id identifier rubyid_change'>change</span>
<span class='comment'>#    @data_elements = Array.new
</span>  <span class='ivar'>@data_elements</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>data_element_collections</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>,</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='ivar'>@data_sheet</span> <span class='op'>=</span> <span class='const'>DataSheet</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@profile</span> <span class='op'>=</span> <span class='const'>Profile</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:profile_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@globe</span> <span class='op'>=</span> <span class='const'>Globe</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:globe_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>

  <span class='ivar'>@data_elements</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_data_element_name'>data_element_name</span><span class='op'>|</span>
    <span class='id identifier rubyid_records'>records</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='id identifier rubyid_data_element_name'>data_element_name</span><span class='rbracket'>]</span>
    <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_records'>records</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_values'>values</span><span class='op'>|</span>
        
        <span class='comment'># Locate the current data element that has faithfully represented our
</span>        <span class='comment'># data up until now.
</span>        <span class='ivar'>@data_element</span> <span class='op'>=</span> <span class='const'>DataElement</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_puts'>puts</span> <span class='ivar'>@data_element</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
        
        <span class='comment'># Construct a new blank data element. This will take a complete copy
</span>        <span class='comment'># of @data_element in order to retain a historical representation.
</span><span class='comment'>#          @retain_data_element = eval(&quot;#{@data_element.type}.new(@data_element.attributes)&quot;)
</span>        <span class='ivar'>@retain_data_element</span> <span class='op'>=</span> <span class='ivar'>@data_element</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span><span class='period'>.</span><span class='id identifier rubyid_constantize'>constantize</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@data_element</span><span class='period'>.</span><span class='id identifier rubyid_attributes'>attributes</span><span class='period'>.</span><span class='id identifier rubyid_except!'>except!</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_puts'>puts</span> <span class='ivar'>@retain_data_element</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>

        <span class='comment'># Loop through all the key, value pairs and update the data_element to ensure
</span>        <span class='comment'># the correct new values are applied.
</span>        <span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_column'>column</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
          <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&gt;&gt; </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data_element_name'>data_element_name</span><span class='rbrace'>}</span><span class='tstring_content'> == </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_id'>id</span><span class='rbrace'>}</span><span class='tstring_content'>: '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_column'>column</span><span class='rbrace'>}</span><span class='tstring_content'>' assign to '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span>
          <span class='id identifier rubyid_eval'>eval</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>@data_element.</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_column'>column</span><span class='rbrace'>}</span><span class='tstring_content'> = '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        
        <span class='comment'># Ensure appropriate versioning is applied to distinguish the latest version.
</span>        <span class='kw'>if</span> <span class='ivar'>@retain_data_element</span><span class='period'>.</span><span class='id identifier rubyid_version'>version</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>then</span>
          <span class='ivar'>@retain_data_element</span><span class='period'>.</span><span class='id identifier rubyid_version'>version</span> <span class='op'>=</span> <span class='int'>0</span>
        <span class='kw'>end</span> <span class='kw'>if</span>
        
<span class='comment'>#          @data_element.version = @retain_data_element.version + 1
</span>        <span class='comment'># Working around version being nil and trying to add an
</span>        <span class='comment'># integer to this. Time.now.to_i could be a better overall
</span>        <span class='comment'># solution anyway. Individual integers going up from 0
</span>        <span class='comment'># was more human readable though.
</span>        <span class='ivar'>@data_element</span><span class='period'>.</span><span class='id identifier rubyid_version'>version</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
        <span class='ivar'>@data_element</span><span class='period'>.</span><span class='id identifier rubyid_updated_at'>updated_at</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>

        <span class='comment'># Ensure the new data_element is current.
</span>        <span class='ivar'>@retain_data_element</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span> <span class='op'>=</span> <span class='kw'>false</span>
        <span class='ivar'>@data_element</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span> <span class='op'>=</span> <span class='kw'>true</span>

<span class='comment'>#          @data_element.update_elements(@retain_data_element, values)
</span>        <span class='comment'># Write back to the database.
</span>        <span class='ivar'>@data_element</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
        <span class='ivar'>@retain_data_element</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
<span class='comment'>#      if @data_element.update_attributes(params[:data_element])
</span>      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_redirect_to'>redirect_to</span><span class='lparen'>(</span><span class='id identifier rubyid_preview_globe_profile_data_sheet_path'>preview_globe_profile_data_sheet_path</span><span class='lparen'>(</span><span class='ivar'>@globe</span><span class='comma'>,</span> <span class='ivar'>@profile</span><span class='comma'>,</span> <span class='ivar'>@data_sheet</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:notice</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Data was successfully updated.</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='comment'>#        format.html { redirect_to(@data_element, :notice =&gt; 'Data was successfully updated.') }
</span>      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_xml'>xml</span>  <span class='lbrace'>{</span> <span class='id identifier rubyid_head'>head</span> <span class='symbol'>:ok</span> <span class='rbrace'>}</span>
<span class='comment'>#      else
</span><span class='comment'>#        format.html { render :action =&gt; &quot;edit&quot; }
</span><span class='comment'>#        format.xml  { render :xml =&gt; @data_element.errors, :status =&gt; :unprocessable_entity }
</span><span class='comment'>#      end
</span>  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create-instance_method">
  
    - (<tt>Object</tt>) <strong>create</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
POST /data_sheets POST /data_sheets.xml
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


67
68
69
70
71
72
73
74
75
76
77
78
79
80
81</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/data_sheets_controller.rb', line 67</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create'>create</span>
  <span class='ivar'>@data_sheet</span> <span class='op'>=</span> <span class='const'>DataSheet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:data_sheet</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@data_sheet</span><span class='period'>.</span><span class='id identifier rubyid_profile_id'>profile_id</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:profile_id</span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='ivar'>@data_sheet</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_redirect_to'>redirect_to</span><span class='lparen'>(</span><span class='id identifier rubyid_globe_profile_data_sheets_url'>globe_profile_data_sheets_url</span><span class='comma'>,</span> <span class='symbol'>:notice</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Data sheet was successfully created.</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span>
      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_xml'>xml</span>  <span class='lbrace'>{</span> <span class='id identifier rubyid_render'>render</span> <span class='symbol'>:xml</span> <span class='op'>=&gt;</span> <span class='ivar'>@data_sheet</span><span class='comma'>,</span> <span class='symbol'>:status</span> <span class='op'>=&gt;</span> <span class='symbol'>:created</span><span class='comma'>,</span> <span class='symbol'>:location</span> <span class='op'>=&gt;</span> <span class='ivar'>@data_sheet</span> <span class='rbrace'>}</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Redirecting to 'New' action</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='symbol'>:action</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>new</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:notice</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid parameters for Data Sheet</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_xml'>xml</span>  <span class='lbrace'>{</span> <span class='id identifier rubyid_render'>render</span> <span class='symbol'>:xml</span> <span class='op'>=&gt;</span> <span class='ivar'>@data_sheet</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span><span class='comma'>,</span> <span class='symbol'>:status</span> <span class='op'>=&gt;</span> <span class='symbol'>:unprocessable_entity</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="destroy-instance_method">
  
    - (<tt>Object</tt>) <strong>destroy</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
DELETE /data_sheets/1 DELETE /data_sheets/1.xml
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


103
104
105
106
107
108
109
110
111</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/data_sheets_controller.rb', line 103</span>

<span class='kw'>def</span> <span class='id identifier rubyid_destroy'>destroy</span>
  <span class='ivar'>@data_sheet</span> <span class='op'>=</span> <span class='const'>DataSheet</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@data_sheet</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>

  <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
    <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_redirect_to'>redirect_to</span><span class='lparen'>(</span><span class='id identifier rubyid_globe_profile_data_sheets_url'>globe_profile_data_sheets_url</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_xml'>xml</span>  <span class='lbrace'>{</span> <span class='id identifier rubyid_head'>head</span> <span class='symbol'>:ok</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="draw-instance_method">
  
    - (<tt>Object</tt>) <strong>draw</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Within this method we must pull the database information back the
collection of database objects that are associated with this data sheet. In
fact, we need to pull the information based on the &#8220;Profile&#8221;.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


150
151
152
153
154
155
156
157
158
159</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/data_sheets_controller.rb', line 150</span>

<span class='kw'>def</span> <span class='id identifier rubyid_draw'>draw</span>
  
  <span class='comment'># Identify the Data Sheet that we wish to display. This will be rendered within the
</span>  <span class='comment'># respond_to block further down.
</span>  <span class='ivar'>@data_sheet</span> <span class='op'>=</span> <span class='const'>DataSheet</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  
  <span class='id identifier rubyid_calculate_data_sheet_elements'>calculate_data_sheet_elements</span><span class='lparen'>(</span><span class='ivar'>@data_sheet</span><span class='rparen'>)</span>
  <span class='id identifier rubyid__draw'>_draw</span><span class='lparen'>(</span><span class='ivar'>@data_sheet</span><span class='rparen'>)</span>
  <span class='comment'>#DataSheetsHelper _draw(@data_sheet)
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="edit-instance_method">
  
    - (<tt>Object</tt>) <strong>edit</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
GET /data_sheets/1/edit
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


59
60
61
62
63</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/data_sheets_controller.rb', line 59</span>

<span class='kw'>def</span> <span class='id identifier rubyid_edit'>edit</span>
  <span class='ivar'>@data_sheet</span> <span class='op'>=</span> <span class='const'>DataSheet</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@profile</span> <span class='op'>=</span> <span class='ivar'>@data_sheet</span><span class='period'>.</span><span class='id identifier rubyid_profile'>profile</span>
  <span class='ivar'>@globe</span> <span class='op'>=</span> <span class='ivar'>@profile</span><span class='period'>.</span><span class='id identifier rubyid_globe'>globe</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="editable-instance_method">
  
    - (<tt>Object</tt>) <strong>editable</strong>(data_element, database_column, id) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


333
334
335
336
337
338</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/data_sheets_controller.rb', line 333</span>

<span class='kw'>def</span> <span class='id identifier rubyid_editable'>editable</span><span class='lparen'>(</span><span class='id identifier rubyid_data_element'>data_element</span><span class='comma'>,</span> <span class='id identifier rubyid_database_column'>database_column</span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_html'>html</span> <span class='op'>=</span> <span class='id identifier rubyid_render'>render</span> <span class='symbol'>:partial</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>editable</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:locals</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='symbol'>:data_element</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_data_element'>data_element</span><span class='comma'>,</span>
                                                          <span class='symbol'>:database_column</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_database_column'>database_column</span><span class='comma'>,</span>
                                                          <span class='symbol'>:id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_id'>id</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_html'>html</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="index-instance_method">
  
    - (<tt>Object</tt>) <strong>index</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
GET /data_sheets GET /data_sheets.xml
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


13
14
15
16
17
18
19
20
21
22</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/data_sheets_controller.rb', line 13</span>

<span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span>
  <span class='ivar'>@profile</span> <span class='op'>=</span> <span class='const'>Profile</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:profile_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@globe</span> <span class='op'>=</span> <span class='ivar'>@profile</span><span class='period'>.</span><span class='id identifier rubyid_globe'>globe</span>
  <span class='ivar'>@data_sheets</span> <span class='op'>=</span> <span class='const'>DataSheet</span><span class='period'>.</span><span class='id identifier rubyid_find_all_by_profile_id'>find_all_by_profile_id</span><span class='lparen'>(</span><span class='ivar'>@profile</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
    <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='comment'># index.html.erb
</span>    <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_xml'>xml</span>  <span class='lbrace'>{</span> <span class='id identifier rubyid_render'>render</span> <span class='symbol'>:xml</span> <span class='op'>=&gt;</span> <span class='ivar'>@data_sheets</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="new-instance_method">
  
    - (<tt>Object</tt>) <strong>new</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
GET /data_sheets/new GET /data_sheets/new.xml
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/data_sheets_controller.rb', line 39</span>

<span class='kw'>def</span> <span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_params'>params</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
  <span class='ivar'>@data_sheet</span> <span class='op'>=</span> <span class='const'>DataSheet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:profile_id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='kw'>then</span>
    <span class='ivar'>@profile</span> <span class='op'>=</span> <span class='const'>Profile</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:profile_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='ivar'>@globe</span> <span class='op'>=</span> <span class='ivar'>@profile</span><span class='period'>.</span><span class='id identifier rubyid_globe'>globe</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-000-</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='ivar'>@profile</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='ivar'>@globe</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='ivar'>@data_sheet</span>

  <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
    <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='comment'># new.html.erb
</span>    <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_xml'>xml</span>  <span class='lbrace'>{</span> <span class='id identifier rubyid_render'>render</span> <span class='symbol'>:xml</span> <span class='op'>=&gt;</span> <span class='ivar'>@data_sheet</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="preview-instance_method">
  
    - (<tt>Object</tt>) <strong>preview</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note todo">
    <strong>TODO:</strong>
    <div class='inline'><p>
Class Method Calls Review to see if we should be making class method calls
to &#8216;Profile&#8217; and &#8216;DataSheet&#8217; or whether these
should be exchanged for instance methods.
</p>
</div>
  </div>

<p>
&#8216;Preview&#8217; is our bland look at how the data can be represented.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/data_sheets_controller.rb', line 117</span>

<span class='kw'>def</span> <span class='id identifier rubyid_preview'>preview</span>
  <span class='ivar'>@masterglobe</span> <span class='op'>=</span> <span class='const'>Globe</span><span class='period'>.</span><span class='id identifier rubyid_find_by_globe_reference!'>find_by_globe_reference!</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_subdomain'>subdomain</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_globes'>globes</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>==</span> <span class='kw'>true</span> <span class='kw'>then</span>
    <span class='ivar'>@globe</span> <span class='op'>=</span> <span class='ivar'>@masterglobe</span>
  <span class='kw'>else</span>
    <span class='comment'># 25-Mar-2013/PL - the globe_id is rarely passed as the param: 'id'
</span>    <span class='comment'># it is usually explicitly 'globe_id'
</span>    <span class='ivar'>@globe</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_globes'>globes</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:globe_id</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='comment'>#      @globe = current_user.globes.find(params[:id])
</span>  <span class='kw'>end</span>
  
  <span class='ivar'>@shadowglobes</span> <span class='op'>=</span> <span class='ivar'>@globe</span><span class='period'>.</span><span class='id identifier rubyid_children'>children</span> <span class='comment'># .sort! { |a,b| a.name.downcase &lt;=&gt; b.name.downcase }
</span>  
<span class='comment'>#    @globe = Globe.find(params[:globe_id])
</span>  <span class='comment'># Updated logic to prevent the returning of nil as a comparison result.
</span>  <span class='comment'>#                                                       13-May-2013/PL
</span>  <span class='ivar'>@profiles</span> <span class='op'>=</span> <span class='ivar'>@globe</span><span class='period'>.</span><span class='id identifier rubyid_profiles'>profiles</span><span class='period'>.</span><span class='id identifier rubyid_sort!'>sort!</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='comma'>,</span><span class='id identifier rubyid_b'>b</span><span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>&lt;=&gt;</span> <span class='id identifier rubyid_b'>b</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>?</span> <span class='int'>1</span> <span class='op'>:</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='op'>&lt;=&gt;</span> <span class='id identifier rubyid_b'>b</span><span class='period'>.</span><span class='id identifier rubyid_position'>position</span> <span class='rbrace'>}</span>
  <span class='ivar'>@active_profile</span> <span class='op'>=</span> <span class='const'>Profile</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:profile_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@data_sheets</span> <span class='op'>=</span> <span class='ivar'>@active_profile</span><span class='period'>.</span><span class='id identifier rubyid_data_sheets'>data_sheets</span>
  <span class='ivar'>@data_sheets</span><span class='period'>.</span><span class='id identifier rubyid_sort!'>sort!</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='comma'>,</span><span class='id identifier rubyid_b'>b</span><span class='op'>|</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span> <span class='op'>&lt;=&gt;</span> <span class='id identifier rubyid_b'>b</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbrace'>}</span>
  <span class='ivar'>@active_data_sheet</span> <span class='op'>=</span> <span class='const'>DataSheet</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  
  <span class='comment'># Retrieve all the database data required.
</span>  <span class='id identifier rubyid_calculate_data_sheet_elements'>calculate_data_sheet_elements</span><span class='lparen'>(</span><span class='ivar'>@active_data_sheet</span><span class='rparen'>)</span>
  
  <span class='comment'># Create a new instance to facilitate...
</span><span class='comment'>#    @profile = Profile.new
</span>  
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="show-instance_method">
  
    - (<tt>Object</tt>) <strong>show</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
GET /data_sheets/1 GET /data_sheets/1.xml
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


26
27
28
29
30
31
32
33
34
35</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/data_sheets_controller.rb', line 26</span>

<span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
  <span class='ivar'>@data_sheet</span> <span class='op'>=</span> <span class='const'>DataSheet</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@profile</span> <span class='op'>=</span> <span class='ivar'>@data_sheet</span><span class='period'>.</span><span class='id identifier rubyid_profile'>profile</span>
  <span class='ivar'>@globe</span> <span class='op'>=</span> <span class='ivar'>@profile</span><span class='period'>.</span><span class='id identifier rubyid_globe'>globe</span>

  <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
    <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='comment'># show.html.erb
</span>    <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_xml'>xml</span>  <span class='lbrace'>{</span> <span class='id identifier rubyid_render'>render</span> <span class='symbol'>:xml</span> <span class='op'>=&gt;</span> <span class='ivar'>@data_sheet</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update-instance_method">
  
    - (<tt>Object</tt>) <strong>update</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
PUT /data_sheets/1 PUT /data_sheets/1.xml
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


85
86
87
88
89
90
91
92
93
94
95
96
97
98
99</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/data_sheets_controller.rb', line 85</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update'>update</span>
  <span class='ivar'>@data_sheet</span> <span class='op'>=</span> <span class='const'>DataSheet</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@profile</span> <span class='op'>=</span> <span class='ivar'>@data_sheet</span><span class='period'>.</span><span class='id identifier rubyid_profile'>profile</span>
  <span class='ivar'>@globe</span> <span class='op'>=</span> <span class='ivar'>@profile</span><span class='period'>.</span><span class='id identifier rubyid_globe'>globe</span>

  <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='ivar'>@data_sheet</span><span class='period'>.</span><span class='id identifier rubyid_update_attributes'>update_attributes</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:data_sheet</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_redirect_to'>redirect_to</span><span class='lparen'>(</span><span class='id identifier rubyid_globe_profile_data_sheet_url'>globe_profile_data_sheet_url</span><span class='comma'>,</span> <span class='symbol'>:notice</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Data sheet was successfully updated.</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span>
      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_xml'>xml</span>  <span class='lbrace'>{</span> <span class='id identifier rubyid_head'>head</span> <span class='symbol'>:ok</span> <span class='rbrace'>}</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_render'>render</span> <span class='symbol'>:action</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>edit</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_xml'>xml</span>  <span class='lbrace'>{</span> <span class='id identifier rubyid_render'>render</span> <span class='symbol'>:xml</span> <span class='op'>=&gt;</span> <span class='ivar'>@data_sheet</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span><span class='comma'>,</span> <span class='symbol'>:status</span> <span class='op'>=&gt;</span> <span class='symbol'>:unprocessable_entity</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Sun May 19 20:26:45 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.2.1 (ruby-1.9.2).
</div>

  </body>
</html>