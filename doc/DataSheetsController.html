<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Class: DataSheetsController</title>
<link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (D)</a> &raquo; 
    
    
    <span class="title">DataSheetsController</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: DataSheetsController
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ActionController::Base</li>
          
            <li class="next"><span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></li>
          
            <li class="next">DataSheetsController</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2"><span class='object_link'><a href="DataSheetsHelper.html" title="DataSheetsHelper (module)">DataSheetsHelper</a></span></dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">app/controllers/data_sheets_controller.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
This controller handles the rendering of the main page containing the one
or more data elements retrieved through the data model. The two major
methods that are triggered by end-user activity are: &#8216;preview&#8217;
and &#8216;change&#8217;.
</p>


  </div>
</div>
<div class="tags">
  <h3>Author:</h3>
<ul class="author">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
Paul Long
</p>
</div>
      
    </li>
  
</ul>

</div>

  
  
  
  
  
  
  
  
  
  
  
  
  
  

  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#_draw-instance_method" title="#_draw (instance method)">- (Object) <strong>_draw</strong>(data_sheet) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#calculate_data_sheet_elements-instance_method" title="#calculate_data_sheet_elements (instance method)">- (Object) <strong>calculate_data_sheet_elements</strong>(data_sheet) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
This method identifies the data model objects that will be required to
support the data sheet that has been passed as a parameter.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#change-instance_method" title="#change (instance method)">- (Object) <strong>change</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create-instance_method" title="#create (instance method)">- (Object) <strong>create</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
POST /data_sheets POST /data_sheets.xml.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#destroy-instance_method" title="#destroy (instance method)">- (Object) <strong>destroy</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
DELETE /data_sheets/1 DELETE /data_sheets/1.xml.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#draw-instance_method" title="#draw (instance method)">- (Object) <strong>draw</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Within this method we must pull the database information back the
collection of database objects that are associated with this data sheet.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#edit-instance_method" title="#edit (instance method)">- (Object) <strong>edit</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
GET /data_sheets/1/edit.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#editable-instance_method" title="#editable (instance method)">- (Object) <strong>editable</strong>(data_element, database_column, id) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#index-instance_method" title="#index (instance method)">- (Object) <strong>index</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
GET /data_sheets GET /data_sheets.xml.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#new-instance_method" title="#new (instance method)">- (Object) <strong>new</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
GET /data_sheets/new GET /data_sheets/new.xml.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#preview-instance_method" title="#preview (instance method)">- (Object) <strong>preview</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
&#8216;Preview&#8217; is our bland look at how the data can be represented.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#show-instance_method" title="#show (instance method)">- (Object) <strong>show</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
GET /data_sheets/1 GET /data_sheets/1.xml.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update-instance_method" title="#update (instance method)">- (Object) <strong>update</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
PUT /data_sheets/1 PUT /data_sheets/1.xml.
</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="DataSheetsHelper.html" title="DataSheetsHelper (module)">DataSheetsHelper</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="DataSheetsHelper.html#Expand_Data_Element-instance_method" title="DataSheetsHelper#Expand_Data_Element (method)">#Expand_Data_Element</a></span>, <span class='object_link'><a href="DataSheetsHelper.html#Label2TextBox2-instance_method" title="DataSheetsHelper#Label2TextBox2 (method)">#Label2TextBox2</a></span>, <span class='object_link'><a href="DataSheetsHelper.html#Label_TextBox_Switch-instance_method" title="DataSheetsHelper#Label_TextBox_Switch (method)">#Label_TextBox_Switch</a></span>, <span class='object_link'><a href="DataSheetsHelper.html#Subscription_Data_Element-instance_method" title="DataSheetsHelper#Subscription_Data_Element (method)">#Subscription_Data_Element</a></span></p>

  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="ApplicationController.html#set_current_user-instance_method" title="ApplicationController#set_current_user (method)">#set_current_user</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="UrlHelper.html" title="UrlHelper (module)">UrlHelper</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="UrlHelper.html#url_for-instance_method" title="UrlHelper#url_for (method)">#url_for</a></span>, <span class='object_link'><a href="UrlHelper.html#with_subdomain-instance_method" title="UrlHelper#with_subdomain (method)">#with_subdomain</a></span></p>

  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="_draw-instance_method">
  
    - (<tt>Object</tt>) <strong>_draw</strong>(data_sheet) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


135
136
137
138
139
140
141
142
143
144
145
146
147
148
149</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/data_sheets_controller.rb', line 135</span>

<span class='kw'>def</span> <span class='id _draw'>_draw</span><span class='lparen'>(</span><span class='id data_sheet'>data_sheet</span><span class='rparen'>)</span>

  <span class='id template'>template</span> <span class='op'>=</span> <span class='const'>Liquid</span><span class='op'>::</span><span class='const'>Template</span><span class='period'>.</span><span class='id parse'>parse</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>{{source_value}} {{destination_value}}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@text</span> <span class='op'>=</span> <span class='id template'>template</span><span class='period'>.</span><span class='id render'>render</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>source_value</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>pop</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>destination_value</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>corn</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='id puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>test test test test test test test test test test test test test test test test</span><span class='tstring_end'>&quot;</span></span>
  
  <span class='id respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id format'>format</span><span class='op'>|</span>
    <span class='comment'># Render the data into the pre-defined .html.erb file stored within:
</span>    <span class='comment'>#         'views/data_sheets/pages/'
</span><span class='comment'>#      format.html { render @data_sheet.file_location }
</span>    <span class='id format'>format</span><span class='period'>.</span><span class='id html'>html</span> <span class='lbrace'>{</span> <span class='id render'>render</span> <span class='symbol'>:partial</span> <span class='op'>=&gt;</span> <span class='ivar'>@data_sheet</span><span class='period'>.</span><span class='id file_location'>file_location</span> <span class='rbrace'>}</span>
     <span class='id format'>format</span><span class='period'>.</span><span class='id xml'>xml</span>  <span class='lbrace'>{</span> <span class='id render'>render</span> <span class='symbol'>:xml</span> <span class='op'>=&gt;</span> <span class='ivar'>@data_sheet</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
 
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="calculate_data_sheet_elements-instance_method">
  
    - (<tt>Object</tt>) <strong>calculate_data_sheet_elements</strong>(data_sheet) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
This method identifies the data model objects that will be required to
support the data sheet that has been passed as a parameter. A special
&#8216;variable&#8217; will be defined dynamically that will allow the
&#8216;Page&#8217; to render the data within the partial associated with
this data sheet.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'></span>
      
      
        <span class='name'>data_sheet</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The data sheet of which we need to collate the appropriate data model
elements.
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/data_sheets_controller.rb', line 156</span>

<span class='kw'>def</span> <span class='id calculate_data_sheet_elements'>calculate_data_sheet_elements</span><span class='lparen'>(</span><span class='id data_sheet'>data_sheet</span><span class='rparen'>)</span>
  <span class='ivar'>@list_of_collections</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id new'>new</span>
  <span class='ivar'>@globe_id</span> <span class='op'>=</span> <span class='id data_sheet'>data_sheet</span><span class='period'>.</span><span class='id profile'>profile</span><span class='period'>.</span><span class='id globe_id'>globe_id</span>
  <span class='ivar'>@custom_stylesheet</span> <span class='op'>=</span> <span class='id data_sheet'>data_sheet</span><span class='period'>.</span><span class='id style_sheets'>style_sheets</span>

  <span class='comment'># This has been included because we found the data model was not being loaded all the
</span>  <span class='comment'># time. The exact cause of this has not been identified.
</span>  <span class='id puts'>puts</span> <span class='const'>DataElement</span><span class='period'>.</span><span class='id all'>all</span><span class='period'>.</span><span class='id count'>count</span>
  
  <span class='comment'># Retrieve the data rows from the link table 'presentations' that will tell
</span>  <span class='comment'># us what data collections should be pulled back for this sheet.
</span>  <span class='ivar'>@outputs</span> <span class='op'>=</span> <span class='const'>Presentation</span><span class='period'>.</span><span class='id find_all_by_data_sheet_id'>find_all_by_data_sheet_id</span><span class='lparen'>(</span><span class='id data_sheet'>data_sheet</span><span class='period'>.</span><span class='id id'>id</span><span class='rparen'>)</span>
  
  <span class='comment'># For each of these data rows there shall be a data collection row to retrieve
</span>  <span class='comment'># and resolve.
</span>  <span class='ivar'>@outputs</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id sheet_part'>sheet_part</span><span class='op'>|</span>

    <span class='comment'># Grab the data element collection.
</span>    <span class='ivar'>@part</span> <span class='op'>=</span> <span class='const'>DataElementCollection</span><span class='period'>.</span><span class='id find'>find</span><span class='lparen'>(</span><span class='id sheet_part'>sheet_part</span><span class='period'>.</span><span class='id data_element_collection_id'>data_element_collection_id</span><span class='rparen'>)</span>
    
    <span class='kw'>if</span> <span class='ivar'>@part</span><span class='period'>.</span><span class='id historic?'>historic?</span> <span class='kw'>then</span>
      <span class='comment'># For historical data sets, such as bank transactions; twitter feeds; etc. we need to
</span>      <span class='comment'># carry out a 'find all' and carry out pagination.
</span>      <span class='id instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@part</span><span class='period'>.</span><span class='id variable_name'>variable_name</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id eval'>eval</span><span class='lparen'>(</span><span class='ivar'>@part</span><span class='period'>.</span><span class='id data_element_type'>data_element_type</span><span class='rparen'>)</span><span class='period'>.</span><span class='id find_all_by_data_element_collection_id_and_globe_id'>find_all_by_data_element_collection_id_and_globe_id</span><span class='lparen'>(</span><span class='ivar'>@part</span><span class='period'>.</span><span class='id id'>id</span><span class='comma'>,</span> <span class='ivar'>@globe_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id paginate'>paginate</span><span class='lparen'>(</span><span class='symbol'>:page</span> <span class='op'>=&gt;</span> <span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:page</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:per_page</span> <span class='op'>=&gt;</span> <span class='ivar'>@part</span><span class='period'>.</span><span class='id page_limit'>page_limit</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='comment'>#        puts &quot;#{@part.data_element_type}.find_all_by_data_element_collection_id_and_globe_id(#{@part.id}, #{@globe_id})&quot;
</span>    <span class='kw'>else</span>
      <span class='comment'># For non-historic data sets, e.g. personal data; statuses; overdraft limits; etc. we
</span>      <span class='comment'># only need to retrieve one record.
</span>      <span class='id instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@part</span><span class='period'>.</span><span class='id variable_name'>variable_name</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id eval'>eval</span><span class='lparen'>(</span><span class='ivar'>@part</span><span class='period'>.</span><span class='id data_element_type'>data_element_type</span><span class='rparen'>)</span><span class='period'>.</span><span class='id find_by_data_element_collection_id_and_globe_id'>find_by_data_element_collection_id_and_globe_id</span><span class='lparen'>(</span><span class='ivar'>@part</span><span class='period'>.</span><span class='id id'>id</span><span class='comma'>,</span> <span class='ivar'>@globe_id</span><span class='comma'>,</span> <span class='symbol'>:order</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>created_at DESC</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      
      <span class='comment'># Debug
</span>      <span class='id puts'>puts</span> <span class='ivar'>@part</span><span class='period'>.</span><span class='id variable_name'>variable_name</span>
      <span class='id puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@part</span><span class='period'>.</span><span class='id data_element_type'>data_element_type</span><span class='rbrace'>}</span><span class='tstring_content'>.find_by_data_element_collection_id_and_globe_id(</span><span class='embexpr_beg'>#{</span><span class='ivar'>@part</span><span class='period'>.</span><span class='id id'>id</span><span class='rbrace'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='ivar'>@globe_id</span><span class='rbrace'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    
    <span class='comment'># Build up list of 'variable' names. Here we're removing the leading '@' sign.
</span>    <span class='ivar'>@list_of_collections</span> <span class='op'>&lt;&lt;</span> <span class='ivar'>@part</span><span class='period'>.</span><span class='id variable_name'>variable_name</span><span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span> <span class='ivar'>@part</span><span class='period'>.</span><span class='id variable_name'>variable_name</span><span class='period'>.</span><span class='id length'>length</span> <span class='op'>-</span> <span class='int'>1</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
  
  <span class='comment'># Debug
</span>  <span class='id puts'>puts</span> <span class='ivar'>@list_of_collections</span><span class='period'>.</span><span class='id join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="change-instance_method">
  
    - (<tt>Object</tt>) <strong>change</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/data_sheets_controller.rb', line 200</span>

<span class='kw'>def</span> <span class='id change'>change</span>
<span class='comment'>#    @data_elements = Array.new
</span>  <span class='ivar'>@data_elements</span> <span class='op'>=</span> <span class='id params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>data_element_collections</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>,</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='ivar'>@data_sheet</span> <span class='op'>=</span> <span class='const'>DataSheet</span><span class='period'>.</span><span class='id find'>find</span><span class='lparen'>(</span><span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@profile</span> <span class='op'>=</span> <span class='const'>Profile</span><span class='period'>.</span><span class='id find'>find</span><span class='lparen'>(</span><span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:profile_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@globe</span> <span class='op'>=</span> <span class='const'>Globe</span><span class='period'>.</span><span class='id find'>find</span><span class='lparen'>(</span><span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:globe_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>

  <span class='ivar'>@data_elements</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id data_element_name'>data_element_name</span><span class='op'>|</span>
    <span class='id records'>records</span> <span class='op'>=</span> <span class='id params'>params</span><span class='lbracket'>[</span><span class='id data_element_name'>data_element_name</span><span class='rbracket'>]</span>
    <span class='kw'>if</span> <span class='lparen'>(</span><span class='id records'>records</span><span class='rparen'>)</span>
      <span class='id records'>records</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id id'>id</span><span class='comma'>,</span> <span class='id values'>values</span><span class='op'>|</span>
        <span class='ivar'>@data_element</span> <span class='op'>=</span> <span class='const'>DataElement</span><span class='period'>.</span><span class='id find'>find</span><span class='lparen'>(</span><span class='id id'>id</span><span class='rparen'>)</span>
        <span class='ivar'>@new_data_element</span> <span class='op'>=</span> <span class='id eval'>eval</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@data_element</span><span class='period'>.</span><span class='id type'>type</span><span class='rbrace'>}</span><span class='tstring_content'>.new(@data_element.attributes)</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='ivar'>@new_data_element</span><span class='period'>.</span><span class='id attributes'>attributes</span> <span class='op'>=</span> <span class='ivar'>@data_element</span><span class='period'>.</span><span class='id attributes'>attributes</span>

        <span class='id values'>values</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id column'>column</span><span class='comma'>,</span> <span class='id value'>value</span><span class='op'>|</span>
          <span class='id puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&gt;&gt; </span><span class='embexpr_beg'>#{</span><span class='id data_element_name'>data_element_name</span><span class='rbrace'>}</span><span class='tstring_content'> == </span><span class='embexpr_beg'>#{</span><span class='id id'>id</span><span class='rbrace'>}</span><span class='tstring_content'>: '</span><span class='embexpr_beg'>#{</span><span class='id column'>column</span><span class='rbrace'>}</span><span class='tstring_content'>' assign to '</span><span class='embexpr_beg'>#{</span><span class='id value'>value</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span>
          <span class='id eval'>eval</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>@new_data_element.</span><span class='embexpr_beg'>#{</span><span class='id column'>column</span><span class='rbrace'>}</span><span class='tstring_content'> = '</span><span class='embexpr_beg'>#{</span><span class='id value'>value</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='kw'>end</span>

<span class='comment'>#            puts &quot;--------------------------------- #{@data_element.type}.new(#{@data_element.attributes})&quot;
</span><span class='comment'>#            @new_data_element.update_attributes(values)
</span><span class='comment'>#            @data_element.update(values)
</span>        <span class='ivar'>@data_element</span><span class='period'>.</span><span class='id update_elements'>update_elements</span><span class='lparen'>(</span><span class='ivar'>@new_data_element</span><span class='comma'>,</span> <span class='id values'>values</span><span class='rparen'>)</span>
        
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>#params.each do |large_key, large_value|
</span>  <span class='comment'>#  if (large_value.kind_of? String) then
</span>  <span class='comment'>#  extract_id = large_key[large_key.length - &quot;_id&quot;.length - large_value.length, large_value.length]
</span>  <span class='comment'>#  puts &quot;-Extracted ID: #{extract_id}&quot;
</span>  <span class='comment'>#  puts &quot;-Extracted Key: #{large_value}&quot;
</span>  <span class='comment'>#    if (extract_id == large_value) then
</span>  <span class='comment'>#      @data_elements &lt;&lt; {large_key =&gt; large_value}
</span>  <span class='comment'>#      params.each do |key, value|
</span>  <span class='comment'>#        if (key.length &gt; &quot;DataElement&quot;.length) then
</span>  <span class='comment'>#          if key[key.length - &quot;DataElement&quot;.length, &quot;DataElement&quot;.length] == &quot;DataElement&quot; then
</span>  <span class='comment'>#            puts &quot;--------#{key} =&gt; #{value}&quot; 
</span>  <span class='comment'>#            h = value.to_hash
</span>  <span class='comment'>#            #          obj = eval(key).find(@data_element)
</span>  <span class='comment'>#            h.keys.each do |subkey|
</span>  <span class='comment'>#              puts &quot;#{subkey} .. --&gt; .. #{h[subkey]}&quot;
</span>  <span class='comment'>#              puts key.downcase + '_' + subkey + '_id'
</span>  <span class='comment'>#              #            @data_element = DataElement.find(params[key.downcase + '_' + subkey + '_id'])
</span>  <span class='comment'>#              puts &quot;#{@data_element}.#{subkey} = #{h[subkey]}&quot;
</span>  <span class='comment'>#              #            eval &quot;@data_element.#{subkey} = '#{h[subkey]}'&quot;
</span>  <span class='comment'>#            end
</span>  <span class='comment'>#          end
</span>  <span class='comment'>#        end
</span>  <span class='comment'>#      end
</span>  <span class='comment'>#    end
</span>  <span class='comment'>#  end
</span>  <span class='comment'>#end
</span>  
<span class='comment'>#    @data_element.hidden = params[&quot;SubscriptionMessageDataElement&quot;]
</span>
  <span class='id respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id format'>format</span><span class='op'>|</span>
<span class='comment'>#      if @data_element.update_attributes(params[:data_element])
</span>      <span class='id format'>format</span><span class='period'>.</span><span class='id html'>html</span> <span class='lbrace'>{</span> <span class='id redirect_to'>redirect_to</span><span class='lparen'>(</span><span class='id preview_globe_profile_data_sheet_path'>preview_globe_profile_data_sheet_path</span><span class='lparen'>(</span><span class='ivar'>@globe</span><span class='comma'>,</span> <span class='ivar'>@profile</span><span class='comma'>,</span> <span class='ivar'>@data_sheet</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='symbol'>:notice</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Data was successfully updated.</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span>
<span class='comment'>#        format.html { redirect_to(@data_element, :notice =&gt; 'Data was successfully updated.') }
</span>      <span class='id format'>format</span><span class='period'>.</span><span class='id xml'>xml</span>  <span class='lbrace'>{</span> <span class='id head'>head</span> <span class='symbol'>:ok</span> <span class='rbrace'>}</span>
<span class='comment'>#      else
</span><span class='comment'>#        format.html { render :action =&gt; &quot;edit&quot; }
</span><span class='comment'>#        format.xml  { render :xml =&gt; @data_element.errors, :status =&gt; :unprocessable_entity }
</span><span class='comment'>#      end
</span>  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="create-instance_method">
  
    - (<tt>Object</tt>) <strong>create</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
POST /data_sheets POST /data_sheets.xml
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


61
62
63
64
65
66
67
68
69
70
71
72
73
74</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/data_sheets_controller.rb', line 61</span>

<span class='kw'>def</span> <span class='id create'>create</span>
  <span class='ivar'>@data_sheet</span> <span class='op'>=</span> <span class='const'>DataSheet</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:data_sheet</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@data_sheet</span><span class='period'>.</span><span class='id profile_id'>profile_id</span> <span class='op'>=</span> <span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:profile_id</span><span class='rbracket'>]</span>

  <span class='id respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id format'>format</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='ivar'>@data_sheet</span><span class='period'>.</span><span class='id save'>save</span>
      <span class='id format'>format</span><span class='period'>.</span><span class='id html'>html</span> <span class='lbrace'>{</span> <span class='id redirect_to'>redirect_to</span><span class='lparen'>(</span><span class='id globe_profile_data_sheets_url'>globe_profile_data_sheets_url</span><span class='comma'>,</span> <span class='symbol'>:notice</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Data sheet was successfully created.</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span>
      <span class='id format'>format</span><span class='period'>.</span><span class='id xml'>xml</span>  <span class='lbrace'>{</span> <span class='id render'>render</span> <span class='symbol'>:xml</span> <span class='op'>=&gt;</span> <span class='ivar'>@data_sheet</span><span class='comma'>,</span> <span class='symbol'>:status</span> <span class='op'>=&gt;</span> <span class='symbol'>:created</span><span class='comma'>,</span> <span class='symbol'>:location</span> <span class='op'>=&gt;</span> <span class='ivar'>@data_sheet</span> <span class='rbrace'>}</span>
    <span class='kw'>else</span>
      <span class='id format'>format</span><span class='period'>.</span><span class='id html'>html</span> <span class='lbrace'>{</span> <span class='id render'>render</span> <span class='symbol'>:action</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>new</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
      <span class='id format'>format</span><span class='period'>.</span><span class='id xml'>xml</span>  <span class='lbrace'>{</span> <span class='id render'>render</span> <span class='symbol'>:xml</span> <span class='op'>=&gt;</span> <span class='ivar'>@data_sheet</span><span class='period'>.</span><span class='id errors'>errors</span><span class='comma'>,</span> <span class='symbol'>:status</span> <span class='op'>=&gt;</span> <span class='symbol'>:unprocessable_entity</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="destroy-instance_method">
  
    - (<tt>Object</tt>) <strong>destroy</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
DELETE /data_sheets/1 DELETE /data_sheets/1.xml
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


96
97
98
99
100
101
102
103
104</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/data_sheets_controller.rb', line 96</span>

<span class='kw'>def</span> <span class='id destroy'>destroy</span>
  <span class='ivar'>@data_sheet</span> <span class='op'>=</span> <span class='const'>DataSheet</span><span class='period'>.</span><span class='id find'>find</span><span class='lparen'>(</span><span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@data_sheet</span><span class='period'>.</span><span class='id destroy'>destroy</span>

  <span class='id respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id format'>format</span><span class='op'>|</span>
    <span class='id format'>format</span><span class='period'>.</span><span class='id html'>html</span> <span class='lbrace'>{</span> <span class='id redirect_to'>redirect_to</span><span class='lparen'>(</span><span class='id globe_profile_data_sheets_url'>globe_profile_data_sheets_url</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
    <span class='id format'>format</span><span class='period'>.</span><span class='id xml'>xml</span>  <span class='lbrace'>{</span> <span class='id head'>head</span> <span class='symbol'>:ok</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="draw-instance_method">
  
    - (<tt>Object</tt>) <strong>draw</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Within this method we must pull the database information back the
collection of database objects that are associated with this data sheet. In
fact, we need to pull the information based on the &#8220;Profile&#8221;.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


124
125
126
127
128
129
130
131
132
133</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/data_sheets_controller.rb', line 124</span>

<span class='kw'>def</span> <span class='id draw'>draw</span>
  
  <span class='comment'># Identify the Data Sheet that we wish to display. This will be rendered within the
</span>  <span class='comment'># respond_to block further down.
</span>  <span class='ivar'>@data_sheet</span> <span class='op'>=</span> <span class='const'>DataSheet</span><span class='period'>.</span><span class='id find'>find</span><span class='lparen'>(</span><span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  
  <span class='id calculate_data_sheet_elements'>calculate_data_sheet_elements</span><span class='lparen'>(</span><span class='ivar'>@data_sheet</span><span class='rparen'>)</span>
  <span class='id _draw'>_draw</span><span class='lparen'>(</span><span class='ivar'>@data_sheet</span><span class='rparen'>)</span>
  <span class='comment'>#DataSheetsHelper _draw(@data_sheet)
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="edit-instance_method">
  
    - (<tt>Object</tt>) <strong>edit</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
GET /data_sheets/1/edit
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


53
54
55
56
57</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/data_sheets_controller.rb', line 53</span>

<span class='kw'>def</span> <span class='id edit'>edit</span>
  <span class='ivar'>@data_sheet</span> <span class='op'>=</span> <span class='const'>DataSheet</span><span class='period'>.</span><span class='id find'>find</span><span class='lparen'>(</span><span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@profile</span> <span class='op'>=</span> <span class='ivar'>@data_sheet</span><span class='period'>.</span><span class='id profile'>profile</span>
  <span class='ivar'>@globe</span> <span class='op'>=</span> <span class='ivar'>@profile</span><span class='period'>.</span><span class='id globe'>globe</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="editable-instance_method">
  
    - (<tt>Object</tt>) <strong>editable</strong>(data_element, database_column, id) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


270
271
272
273
274
275</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/data_sheets_controller.rb', line 270</span>

<span class='kw'>def</span> <span class='id editable'>editable</span><span class='lparen'>(</span><span class='id data_element'>data_element</span><span class='comma'>,</span> <span class='id database_column'>database_column</span><span class='comma'>,</span> <span class='id id'>id</span><span class='rparen'>)</span>
  <span class='id html'>html</span> <span class='op'>=</span> <span class='id render'>render</span> <span class='symbol'>:partial</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>editable</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:locals</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='symbol'>:data_element</span> <span class='op'>=&gt;</span> <span class='id data_element'>data_element</span><span class='comma'>,</span>
                                                          <span class='symbol'>:database_column</span> <span class='op'>=&gt;</span> <span class='id database_column'>database_column</span><span class='comma'>,</span>
                                                          <span class='symbol'>:id</span> <span class='op'>=&gt;</span> <span class='id id'>id</span> <span class='rbrace'>}</span>
  <span class='id html'>html</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="index-instance_method">
  
    - (<tt>Object</tt>) <strong>index</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
GET /data_sheets GET /data_sheets.xml
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


13
14
15
16
17
18
19
20
21
22</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/data_sheets_controller.rb', line 13</span>

<span class='kw'>def</span> <span class='id index'>index</span>
  <span class='ivar'>@profile</span> <span class='op'>=</span> <span class='const'>Profile</span><span class='period'>.</span><span class='id find'>find</span><span class='lparen'>(</span><span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:profile_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@globe</span> <span class='op'>=</span> <span class='ivar'>@profile</span><span class='period'>.</span><span class='id globe'>globe</span>
  <span class='ivar'>@data_sheets</span> <span class='op'>=</span> <span class='const'>DataSheet</span><span class='period'>.</span><span class='id find_all_by_profile_id'>find_all_by_profile_id</span><span class='lparen'>(</span><span class='ivar'>@profile</span><span class='period'>.</span><span class='id id'>id</span><span class='rparen'>)</span>

  <span class='id respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id format'>format</span><span class='op'>|</span>
    <span class='id format'>format</span><span class='period'>.</span><span class='id html'>html</span> <span class='comment'># index.html.erb
</span>    <span class='id format'>format</span><span class='period'>.</span><span class='id xml'>xml</span>  <span class='lbrace'>{</span> <span class='id render'>render</span> <span class='symbol'>:xml</span> <span class='op'>=&gt;</span> <span class='ivar'>@data_sheets</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="new-instance_method">
  
    - (<tt>Object</tt>) <strong>new</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
GET /data_sheets/new GET /data_sheets/new.xml
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


39
40
41
42
43
44
45
46
47
48
49
50</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/data_sheets_controller.rb', line 39</span>

<span class='kw'>def</span> <span class='id new'>new</span>
  <span class='ivar'>@data_sheet</span> <span class='op'>=</span> <span class='const'>DataSheet</span><span class='period'>.</span><span class='id new'>new</span>
  <span class='kw'>if</span> <span class='op'>!</span><span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:profile_id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id blank?'>blank?</span> <span class='kw'>then</span>
    <span class='ivar'>@profile</span> <span class='op'>=</span> <span class='const'>Profile</span><span class='period'>.</span><span class='id find'>find</span><span class='lparen'>(</span><span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:profile_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='ivar'>@globe</span> <span class='op'>=</span> <span class='ivar'>@profile</span><span class='period'>.</span><span class='id globe'>globe</span>
  <span class='kw'>end</span>

  <span class='id respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id format'>format</span><span class='op'>|</span>
    <span class='id format'>format</span><span class='period'>.</span><span class='id html'>html</span> <span class='comment'># new.html.erb
</span>    <span class='id format'>format</span><span class='period'>.</span><span class='id xml'>xml</span>  <span class='lbrace'>{</span> <span class='id render'>render</span> <span class='symbol'>:xml</span> <span class='op'>=&gt;</span> <span class='ivar'>@data_sheet</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="preview-instance_method">
  
    - (<tt>Object</tt>) <strong>preview</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    
  <div class="note todo">
    <strong>TODO:</strong> 
    <div class='inline'><p>
Class Method Calls Review to see if we should be making class method calls
to &#8216;Profile&#8217; and &#8216;DataSheet&#8217; or whether these
should be exchanged for instance methods.
</p>
</div>
  </div>

<p>
&#8216;Preview&#8217; is our bland look at how the data can be represented.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


110
111
112
113
114
115
116
117
118
119</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/data_sheets_controller.rb', line 110</span>

<span class='kw'>def</span> <span class='id preview'>preview</span>
  <span class='ivar'>@globe</span> <span class='op'>=</span> <span class='const'>Globe</span><span class='period'>.</span><span class='id find'>find</span><span class='lparen'>(</span><span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:globe_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@profiles</span> <span class='op'>=</span> <span class='ivar'>@globe</span><span class='period'>.</span><span class='id profiles'>profiles</span>
  <span class='ivar'>@active_profile</span> <span class='op'>=</span> <span class='const'>Profile</span><span class='period'>.</span><span class='id find'>find</span><span class='lparen'>(</span><span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:profile_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@data_sheets</span> <span class='op'>=</span> <span class='ivar'>@active_profile</span><span class='period'>.</span><span class='id data_sheets'>data_sheets</span>
  <span class='ivar'>@active_data_sheet</span> <span class='op'>=</span> <span class='const'>DataSheet</span><span class='period'>.</span><span class='id find'>find</span><span class='lparen'>(</span><span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  
  <span class='comment'># Retrieve all the database data required.
</span>  <span class='id calculate_data_sheet_elements'>calculate_data_sheet_elements</span><span class='lparen'>(</span><span class='ivar'>@active_data_sheet</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="show-instance_method">
  
    - (<tt>Object</tt>) <strong>show</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
GET /data_sheets/1 GET /data_sheets/1.xml
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


26
27
28
29
30
31
32
33
34
35</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/data_sheets_controller.rb', line 26</span>

<span class='kw'>def</span> <span class='id show'>show</span>
  <span class='ivar'>@data_sheet</span> <span class='op'>=</span> <span class='const'>DataSheet</span><span class='period'>.</span><span class='id find'>find</span><span class='lparen'>(</span><span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@profile</span> <span class='op'>=</span> <span class='ivar'>@data_sheet</span><span class='period'>.</span><span class='id profile'>profile</span>
  <span class='ivar'>@globe</span> <span class='op'>=</span> <span class='ivar'>@profile</span><span class='period'>.</span><span class='id globe'>globe</span>

  <span class='id respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id format'>format</span><span class='op'>|</span>
    <span class='id format'>format</span><span class='period'>.</span><span class='id html'>html</span> <span class='comment'># show.html.erb
</span>    <span class='id format'>format</span><span class='period'>.</span><span class='id xml'>xml</span>  <span class='lbrace'>{</span> <span class='id render'>render</span> <span class='symbol'>:xml</span> <span class='op'>=&gt;</span> <span class='ivar'>@data_sheet</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="update-instance_method">
  
    - (<tt>Object</tt>) <strong>update</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
PUT /data_sheets/1 PUT /data_sheets/1.xml
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


78
79
80
81
82
83
84
85
86
87
88
89
90
91
92</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/data_sheets_controller.rb', line 78</span>

<span class='kw'>def</span> <span class='id update'>update</span>
  <span class='ivar'>@data_sheet</span> <span class='op'>=</span> <span class='const'>DataSheet</span><span class='period'>.</span><span class='id find'>find</span><span class='lparen'>(</span><span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@profile</span> <span class='op'>=</span> <span class='ivar'>@data_sheet</span><span class='period'>.</span><span class='id profile'>profile</span>
  <span class='ivar'>@globe</span> <span class='op'>=</span> <span class='ivar'>@profile</span><span class='period'>.</span><span class='id globe'>globe</span>

  <span class='id respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id format'>format</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='ivar'>@data_sheet</span><span class='period'>.</span><span class='id update_attributes'>update_attributes</span><span class='lparen'>(</span><span class='id params'>params</span><span class='lbracket'>[</span><span class='symbol'>:data_sheet</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='id format'>format</span><span class='period'>.</span><span class='id html'>html</span> <span class='lbrace'>{</span> <span class='id redirect_to'>redirect_to</span><span class='lparen'>(</span><span class='id globe_profile_data_sheet_url'>globe_profile_data_sheet_url</span><span class='comma'>,</span> <span class='symbol'>:notice</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Data sheet was successfully updated.</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span>
      <span class='id format'>format</span><span class='period'>.</span><span class='id xml'>xml</span>  <span class='lbrace'>{</span> <span class='id head'>head</span> <span class='symbol'>:ok</span> <span class='rbrace'>}</span>
    <span class='kw'>else</span>
      <span class='id format'>format</span><span class='period'>.</span><span class='id html'>html</span> <span class='lbrace'>{</span> <span class='id render'>render</span> <span class='symbol'>:action</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>edit</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
      <span class='id format'>format</span><span class='period'>.</span><span class='id xml'>xml</span>  <span class='lbrace'>{</span> <span class='id render'>render</span> <span class='symbol'>:xml</span> <span class='op'>=&gt;</span> <span class='ivar'>@data_sheet</span><span class='period'>.</span><span class='id errors'>errors</span><span class='comma'>,</span> <span class='symbol'>:status</span> <span class='op'>=&gt;</span> <span class='symbol'>:unprocessable_entity</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Mon Apr 18 14:49:44 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.8 (ruby-1.9.2).
</div>

  </body>
</html>